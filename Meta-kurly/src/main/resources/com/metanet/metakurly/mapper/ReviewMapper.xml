<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.metanet.metakurly.mapper.ReviewMapper">

   <!-- 내가 작성한 리뷰 가져오기 -->
   <select id="getMyReviewList"
      resultType="com.metanet.metakurly.domain.ReviewDTO">

   <![CDATA[
        select * from review where m_id = #{m_id}
     ]]>

   </select>
   
   
   <!-- 특정 상품에 해당하는 리뷰 리스트 가져오기 -->
   <select id="getProductReviewList"
      resultType="com.metanet.metakurly.domain.ReviewDTO"
      resultMap="productReviewList">
      select r.r_id, r.m_id, r.review_date, r.contents, r.p_id, p.price, p.name 
      from review r, product p
      where r.p_id = p.p_id
      and r.p_id = #{p_id}
   </select>
   
   <resultMap type="com.metanet.metakurly.domain.ReviewDTO" id="productReviewList">
       <result property="price" column="price"/>
       <result property="name" column="name"/>
   </resultMap>
   

   <!-- 내가 구매한 상품 리뷰 작성하기 -->
   <insert id="registerReview">
      insert into review 
      values (review_seq.nextval, #{m_id}, sysDate, #{contents}, #{p_id})
   </insert>


   <!-- 내가 구매한 상품 리뷰 수정하기 -->
   <update id="updateReview">
      update review
      set contents = #{contents},
      m_id = #{m_id},
      p_id = #{p_id},
      review_date = sysDate
      where m_id = #{m_id}
      and r_id = #{r_id}
      and p_id = #{p_id}
   </update>
   
   
   <!-- 내가 구매해서 작성한 리뷰 삭제하기 -->
   <delete id="deleteReview">
        delete from review 
        where m_id = #{m_id}
        and r_id = #{r_id}
        and p_id = #{p_id}
    </delete>

</mapper>